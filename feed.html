<html>
<head>
	<title>Status Reporting App in React.js using Appbase </title>
	<script src="https://fb.me/react-0.13.3.js"></script>
	<script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
	<script src="bower_components/appbase-js/browser/appbase.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	 <!-- Compiled and minified CSS -->
  	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min.js"></script>
	<!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
	<div id="container">
		<div class="row">
        <div class="col s12 m6 l4">
          <div class="card-panel white">
            <div class="card-content gray-text">
              <span class="card-title">This is my 1st card. Sample Text.</span>
            </div>
          </div>
        </div>
        <div class="col s12 m6 l4">
          <div class="card-panel white">
            <div class="card-content gray-text">
              <span class="card-title">This is my 2nd card. Sample Text.</span>
            </div>
          </div>
        </div>
        <div class="col s12 m6 l4">
          <div class="card-panel white">
            <div class="card-content gray-text">
              <span class="card-title">This is my 3rd card. Sample Text.</span>
            </div>
          </div>
        </div>

      </div>
	</div>
	<script type="text/jsx">
		var FeedItem = React.createClass({
			render: function() {
				return (
					<div className="col s12 m6 l4">
			          <div className="card-panel white">
			            <div className="card-content gray-text">
			              <span className="card-title">{this.props.status}</span>
			            </div>
			          </div>
			        </div>
				);
			}
		})

		var FeedItems = React.createClass({
			render: function() {

				var content;
				if (this.props.statusList.length > 0) {
				  content = this.props.statusList.map(function(status) {
				    return <FeedItem status={status} />;
				  });
				} else {
				  content = <FeedItem status="No content Available!" />;
				}

				return (
					<div className="row">
						<h3 className="col s12 center white-text"> Working on Feed</h3>
						{content}
					</div>
				);
			}
		})
		
		var Feed = React.createClass({

			getInitialState: function() {
				var self = this;
				var appbaseRef = new Appbase({
				  url: 'https://scalr.api.appbase.io',
				  appname: 'workingon',
				  username: 'iiyvFcb3A',
				  password: 'b3a36a4d-e517-451c-a04f-a11dc2c4b4bc'
				})

				appbaseRef.search({
					type: "feed",
					body: {
					    query: {
					      match_all: {}
					    }
					  }
					}).on('data', function(res) {
					  $.map(res.hits.hits, function(object){
						self.addStatus(object._source.status)
					  })
					}).on('error', function(err) {
					  console.log("search error: ", err);
				})

				appbaseRef.searchStream({
				  type: "feed",
				  body: {
				    query: {
				      match_all: {}
				    }
				  }
				}).on('data', function(res) {
				  self.addStatus(res._source.status)
				}).on('error', function(err) {
				  console.log("streaming error: ", err);
				})	
				return {
					statusList: [] 
				};
			},
			addStatus: function(newStatusItem){
				var updated = this.state.statusList;
	    		updated.unshift(newStatusItem)
	    		this.setState({statusList: updated});
			},
			render: function() {
				return (
					<FeedItems statusList={this.state.statusList}/>
				);
			}
		
		});

		React.render(
		  <Feed />,
		  document.getElementById('container')
		);
	</script>

</body>
</html>